id: incident/host/macos-quick-triage
title: Host quick triage (macOS)
tags: [incident, macos, triage]
vars:
  suspect_pid: {type: int, required: false}
  lookback_minutes: {type: int, default: 60}
steps:
  - include:
      id: macos/users/logged-on
    title: Current logged-on users

  - include:
      id: macos/network/connections
    title: Active network connections

  - include:
      id: macos/process/list
    title: Running processes snapshot

  - include:
      id: macos/auth/failures
      vars:
        minutes: "{{ lookback_minutes }}"
    title: Recent auth failures

  - include:
      id: macos/persistence/launch-items
    title: Persistence checks (LaunchAgents/Daemons)

  - include:
      id: macos/files/recent-mods
      vars:
        minutes: "{{ lookback_minutes }}"
    title: Recent file changes in key dirs

  - name: Optional: triage a suspect process
    render:
      bash: |
        if [ "{{ suspect_pid | default('') }}" != "" ]; then
          echo "# Delegate to macos/process/triage for PID {{ suspect_pid }}"
        else
          echo "# No suspect_pid provided. Skipping detailed triage."
        fi

  - include:
      id: macos/process/triage
      vars:
        pid: "{{ suspect_pid | default('0') }}"
    title: Detailed process triage (if suspect_pid set)
